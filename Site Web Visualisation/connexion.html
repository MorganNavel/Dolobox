<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion | DoloBox Viz</title>
    <!-- Feuille de style CSS -->
    <link rel="stylesheet" href="styles_connexion.css">
</head>
<body>

<main>
  <div class="login-page">
    <div class="container">
      <img src="res/img/boitier.png" alt="Logo DoloBox VIZ">
      <div class="titre">
          <h1 class="logo">DoloBox VIZ</h1>
          <h6>Outil de visualisation de la douleur des patients</h6>
      </div>
    </div>
    
    <div class="form">
      <form id="loginForm" class="login-form">
        <input id="identifiant" placeholder="identifiant"/>
        <input id="motdepasse" placeholder="mot de passe"/>
        <button id="connexion" type='button'>Connexion</button>
        <p class="denied" id="denied"></p>
      </form>
    </div>
  </div>
</main>

<!-- Scripts JavaScript -->
<script>
  /**
   * Récupère la valeur du cookie passé en paramètre
   * @param {string} name le nom du cookie
   * @returns {string} valeur du cookie
   */
  function getCookie(name) {
    const cookies = document.cookie.split(";");
    for (let cookie of cookies) {
      const [cookieName, cookieValue] = cookie.split("=");
      if (cookieName.trim() === name) {
        return cookieValue;
      }
    }
    return null;
  }

  //Suppresion du cookie de connexion à l'arrivée sur la page de connexion
  document.cookie = "token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
</script>
<script type="module">
  import { Connexion } from './project-ui/src/index.js';
    
  //Gestion du bouton d'authentification
  document.getElementById("connexion").addEventListener("click", async function(event) {
    var identifiant = document.getElementById("identifiant").value;
    var motdepasse = document.getElementById("motdepasse").value;

    console.log("click")
    var connected = await Connexion(identifiant,motdepasse);
    console.log("connected")
    if(connected){
      console.log("authentification validée")
      document.location.href="accueil.html";
    } else {
      console.log("authentification rejetée")
      var denied = document.getElementById('denied');
      denied.innerHTML = "identifiants rejetés";
    }
  });
</script>
</body>
</html>